{
  "model" : "gemini/gemini-3-flash-preview",
  "messages" : [ {
    "role" : "system",
    "content" : "You are an expert software engineer. Your task is to extract a concise coding style guide from the provided code examples."
  }, {
    "role" : "user",
    "content" : "Based on these code examples, create a concise, clear coding style guide in Markdown format\nthat captures the conventions used in this codebase, particularly the ones that leverage new or uncommon features.\nDO NOT repeat what are simply common best practices.\n\n<file path=\"components\\customHooks\\useUserData.ts\">\n\"use client\";\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { usePathname, useRouter } from \"next/navigation\";\r\nimport axios from \"axios\";\r\n\r\nconst SAFE_PATHS = new Set<string>([\"/\", \"/Login\", \"/SignUp\", \"/ForgotPassword\"]);\r\n\r\nconst useUserData = () => {\r\n  const [userData, setUserData] = useState<any>({});\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n  const pathname = usePathname();\r\n  const router = useRouter();\r\n  const mounted = useRef(true);\r\n\r\n  useEffect(() => {\r\n    mounted.current = true;\r\n    return () => { mounted.current = false; };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!pathname) return;\r\n\r\n    const fetchData = async () => {\r\n      try {\r\n        const res = await axios.get(\"/api/getUserData\", { withCredentials: true });\r\n        if (!mounted.current) return;\r\n        setUserData(res.data);\r\n        setIsLoading(false);\r\n      } catch (err: any) {\r\n        if (!mounted.current) return;\r\n\r\n        const status = axios.isAxiosError(err) ? err.response?.status : undefined;\r\n\r\n        if (status === 401) {\r\n          const current = pathname;\r\n\r\n          if (!SAFE_PATHS.has(current)) {\r\n            setError(\"Unauthorized\");\r\n            router.replace(`/Login?next=${encodeURIComponent(pathname)}`);\r\n          } else {\r\n            setError(\"Not logged in\");\r\n          }\r\n        } else {\r\n          setError(err?.message || \"An error occurred\");\r\n        }\r\n\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [pathname, router]);\r\n\r\n  return { userData, isLoading, error };\r\n};\r\n\r\nexport default useUserData;\r\n\n</file>\n<file path=\"components\\header.tsx\">\n\"use client\";\r\nimport React, { FC } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport Image from \"next/image\";\r\n\r\nconst Header: FC = () => {\r\n  const router = useRouter();\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      await fetch(\"/api/logout\", { method: \"GET\" });\r\n      router.push(\"/\");\r\n    } catch (error) {\r\n      console.error(\"Logout failed:\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <header className=\"bg-blue-500 text-white p-4 z-10\">\r\n      <div className=\"mx-auto flex justify-between items-center\">\r\n        <div className=\"flex items-center\">\r\n          <Image\r\n            src=\"/logo.png\"\r\n            alt=\"LingoListen AI Logo\"\r\n            width={90}\r\n            height={90}\r\n            className=\"lg:block hidden\"\r\n          />\r\n          <h1 className=\"lg:text-5xl md:text-3xl font-bold lg:ml-9\">\r\n            LingoListen AI\r\n          </h1>\r\n        </div>\r\n        <nav>\r\n          <ul className=\"flex flex-col sm:flex-row sm:space-x-6 lg:space-x-9 sm:mr-9\">\r\n            <li className=\"hover:scale-110 transition duration-300 text-sm lg:text-xl\">\r\n              <Link href=\"/LanguageSelection\">Language Settings</Link>\r\n            </li>\r\n\t\t\t{/* Added Manage Subscription link\r\n            <li className=\"hover:scale-110 transition duration-300 text-sm lg:text-xl\">\r\n              <Link href=\"/ManageSubscription\">Manage Subscription</Link>\r\n            </li>\r\n\t\t\t*/}\r\n            <li className=\"hover:scale-110 transition duration-300 text-sm lg:text-xl\">\r\n              <button onClick={handleLogout}>Log Out</button>\r\n            </li>\r\n          </ul>\r\n        </nav>\r\n      </div>\r\n    </header>\r\n  );\r\n};\r\n\r\nexport default Header;\r\n\n</file>\n<file path=\"app\\Dashboard\\page.tsx\">\n\"use client\";\r\nimport React, { useState, useRef, useCallback } from \"react\";\r\nimport Loading from \"@/components/loading\";\r\nimport useUserData from \"@/components/customHooks/useUserData\";\r\nimport { ChatOpenAI } from \"@langchain/openai\";\r\nimport { SystemMessage, HumanMessage } from \"@langchain/core/messages\";\r\nimport MicToggle from \"@/components/micToggle\";\r\n\r\ntype ConversationEntry = {\r\n  from: string;\r\n  text: string;\r\n};\r\n\r\ntype DifficultyLevel = \"Beginner\" | \"Intermediate\" | \"Expert\" | \"Fluent\";\r\n\r\nexport default function Dashboard() {\r\n  const { userData, isLoading, error } = useUserData();\r\n  const [conversation, setConversation] = useState<ConversationEntry[]>([]);\r\n  const [isRecording, setIsRecording] = useState(false);\r\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n  const streamRef = useRef<MediaStream | null>(null);\r\n\r\n  const beginnerPrompt = `Your name is no longer ChatGPT or OpenAI. Your name is LingoListen AI. You are a language learning assistant. Imagine you are talking to someone who is just learning ${userData.learningLanguage}. Respond by asking them how their day was or how they are doing. Keep your sentences short, simple, and easy to understand. Please reply with only one or two sentences at a time unless the user shows signs of increased proficiency. You are to only reply to the user in ${userData.learningLanguage} no matter what.`;\r\n  const intermediatePrompt = `Your name is no longer ChatGPT or OpenAI. Your name is LingoListen AI. You are a language learning assistant. Engage in conversations about daily routines, hobbies, and interests with someone who has a basic understanding of ${userData.learningLanguage}. Use moderately complex sentences, encourage the user to expand their vocabulary. Reply with two to three sentences, gradually introducing new words and phrases. You are to only reply to the user in ${userData.learningLanguage} no matter what.`;\r\n  const expertPrompt = `Your name is no longer ChatGPT or OpenAI. Your name is LingoListen AI. You are a language learning assistant. Dive into abstract topics, current events, or cultural differences. Challenge the user with complex sentence structures and nuanced vocabulary. Engage in debates or thought-provoking discussions, responding in detailed paragraphs. Encourage expression of opinions and feelings, and refine idiomatic expressions and advanced language concepts. You are to only reply to the user in ${userData.learningLanguage} no matter what.`;\r\n  const fluentPrompt = `Your name is no longer ChatGPT or OpenAI. Your name is LingoListen AI. You are a language learning assistant. Discuss complex subjects like history, philosophy, or technology. Focus on the subtleties of ${userData.learningLanguage}, idiomatic expressions, and cultural references. Engage in long-form discussions, using sophisticated and intricate language structures. Provide detailed responses, mimicking the fluency of a native speaker, to help the user perfect their command of ${userData.learningLanguage}. You are to only reply to the user in ${userData.learningLanguage} no matter what.`;\r\n\r\n  const prompts = {\r\n    Beginner: beginnerPrompt,\r\n    Intermediate: intermediatePrompt,\r\n    Expert: expertPrompt,\r\n    Fluent: fluentPrompt,\r\n  };\r\n\r\n  const prompt = prompts[userData.difficulty as DifficultyLevel];\r\n\r\n  const maxTokensByDifficulty = {\r\n    Beginner: 30,\r\n    Intermediate: 70,\r\n    Expert: 150,\r\n    Fluent: 350,\r\n  };\r\n  const setMaxTokens =\r\n    maxTokensByDifficulty[userData.difficulty as DifficultyLevel];\r\n\r\n  const model = new ChatOpenAI({\r\n    openAIApiKey: process.env.NEXT_PUBLIC_OPENAI_KEY,\r\n    temperature: 0.5,\r\n    modelName: \"gpt-4\",\r\n    maxTokens: setMaxTokens,\r\n  });\r\n\r\n  const difficultyTips: Record<DifficultyLevel, string> = {\r\n    Beginner:\r\n      \"Tip: Start with basic greetings and everyday phrases. Practice simple sentences and common questions. For example, 'How are you?', 'What is your name?', or 'Where are you from?'.\",\r\n    Intermediate:\r\n      \"Tip: Engage in conversations about familiar topics like daily routines, hobbies, and interests. Try to expand your vocabulary and use more complex sentence structures. For instance, discuss your favorite movie or describe your typical day.\",\r\n    Expert:\r\n      \"Tip: Challenge yourself with abstract and nuanced topics. Engage in debates or discussions about current events, cultural differences, or professional topics. Try to express your opinions and feelings more intricately.\",\r\n    Fluent:\r\n      \"Tip: Immerse yourself in the subtleties and idiomatic expressions of the language. Engage in long-form discussions about complex subjects like history, philosophy, or technology. Focus on refining your accent and fluency to sound more like a native speaker.\",\r\n  };\r\n\r\n  const languageToISO: Record<string, string> = {\r\n    spanish: \"es\",\r\n    english: \"en\",\r\n    french: \"fr\",\r\n    german: \"de\",\r\n    italian: \"it\",\r\n    portuguese: \"pt\",\r\n    japanese: \"ja\",\r\n    chinese: \"zh\",\r\n    korean: \"ko\",\r\n    arabic: \"ar\",\r\n    hindi: \"hi\",\r\n    russian: \"ru\",\r\n    turkish: \"tr\",\r\n    dutch: \"nl\",\r\n    swedish: \"sv\",\r\n    norwegian: \"no\",\r\n    danish: \"da\",\r\n    polish: \"pl\",\r\n    greek: \"el\",\r\n  };\r\n\r\n  const isoLanguage =\r\n    languageToISO[(userData.learningLanguage || \"\").toLowerCase()] || \"\";\r\n  const uid = () =>\r\n    (globalThis.crypto?.randomUUID?.() ||\r\n      Math.random().toString(36).slice(2)) as string;\r\n\r\n  const handleRecordingToggle = async () => {\r\n    const rec = mediaRecorderRef.current;\r\n\r\n    if (isRecording && rec) {\r\n      try {\r\n        if (rec.state === \"recording\") {\r\n          const stopped = new Promise<void>((resolve, reject) => {\r\n            const onStop = () => {\r\n              rec.removeEventListener(\"stop\", onStop);\r\n              rec.removeEventListener(\"error\", onError as EventListener);\r\n              resolve();\r\n            };\r\n            const onError = (ev: Event) => {\r\n              const err =\r\n                (ev as any)?.error ??\r\n                new Error(\"MediaRecorder error (no detail)\");\r\n              rec.removeEventListener(\"stop\", onStop);\r\n              rec.removeEventListener(\"error\", onError as EventListener);\r\n              reject(err);\r\n            };\r\n            rec.addEventListener(\"stop\", onStop, { once: true });\r\n            rec.addEventListener(\"error\", onError as EventListener, {\r\n              once: true,\r\n            });\r\n          });\r\n\r\n          try {\r\n            rec.requestData(); \r\n          } catch {\r\n            console.warn(\"Failed to request data from MediaRecorder\");\r\n          }\r\n          rec.stop();\r\n\r\n          await stopped;\r\n        }\r\n      } finally {\r\n        streamRef.current?.getTracks().forEach((t) => t.stop());\r\n        streamRef.current = null;\r\n        mediaRecorderRef.current = null;\r\n        setIsRecording(false);\r\n      }\r\n      return;\r\n    }\r\n\r\n    const stream = await navigator.mediaDevices.getUserMedia({\r\n      audio: {\r\n        echoCancellation: true,\r\n        noiseSuppression: true,\r\n        autoGainControl: true,\r\n      },\r\n    });\r\n    streamRef.current = stream;\r\n\r\n    const preferredMime =\r\n      MediaRecorder.isTypeSupported(\"audio/webm;codecs=opus\")\r\n        ? \"audio/webm;codecs=opus\"\r\n        : MediaRecorder.isTypeSupported(\"audio/mp4\")\r\n        ? \"audio/mp4\"\r\n        : \"\";\r\n\r\n    const mediaRecorder = new MediaRecorder(\r\n      stream,\r\n      preferredMime ? { mimeType: preferredMime } : undefined\r\n    );\r\n    mediaRecorderRef.current = mediaRecorder;\r\n\r\n    let audioChunks: BlobPart[] = [];\r\n    let chunkCount = 0;\r\n\r\n    mediaRecorder.ondataavailable = (event) => {\r\n      if (event.data && event.data.size > 0) {\r\n        audioChunks.push(event.data);\r\n        chunkCount++;\r\n      }\r\n    };\r\n\r\n    mediaRecorder.onstop = async () => {\r\n      try {\r\n        const type =\r\n          mediaRecorder.mimeType || preferredMime || \"audio/webm;codecs=opus\";\r\n        const audioBlob = new Blob(audioChunks, { type });\r\n        const size = audioBlob.size;\r\n        const ext = type.includes(\"mp4\") ? \"mp4\" : \"webm\";\r\n        audioChunks = []; \r\n\r\n        console.log(\r\n          \"[Recorder] mime:\",\r\n          type,\r\n          \"chunks:\",\r\n          chunkCount,\r\n          \"bytes:\",\r\n          size\r\n        );\r\n        if (!size || size < 1024) {\r\n          console.warn(\r\n            \"Audio blob is very small; likely silence or recording did not start correctly.\"\r\n          );\r\n        }\r\n\r\n        await transcribeAudio(audioBlob, ext);\r\n      } catch (e) {\r\n        console.error(\"onstop processing failed:\", e);\r\n      }\r\n    };\r\n\r\n    mediaRecorder.start(250);\r\n    setIsRecording(true);\r\n  };\r\n\r\n  const transcribeAudio = async (audioBlob: Blob, ext: \"webm\" | \"mp4\") => {\r\n    const formData = new FormData();\r\n    const filename = `audio-${uid()}.${ext}`;\r\n    const file = new File([audioBlob], filename, { type: audioBlob.type });\r\n    formData.append(\"file\", file);\r\n    formData.append(\"model\", \"whisper-1\");\r\n    if (isoLanguage) formData.append(\"language\", isoLanguage);\r\n    formData.append(\"response_format\", \"json\");\r\n\r\n    try {\r\n      const response = await fetch(\r\n        `https://api.openai.com/v1/audio/transcriptions?ts=${Date.now()}`,\r\n        {\r\n          method: \"POST\",\r\n          cache: \"no-store\",\r\n          headers: {\r\n            Authorization: `Bearer ${process.env.NEXT_PUBLIC_OPENAI_KEY}`,\r\n          },\r\n          body: formData,\r\n        }\r\n      );\r\n\r\n      if (!response.ok) {\r\n        console.error(\"Transcription status:\", response.status);\r\n        console.error(\"Transcription body:\", await response.text());\r\n        throw new Error(`Transcription failed: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      const text = (data?.text ?? \"\").toString().trim();\r\n      console.log(\"[Whisper] text:\", text);\r\n      handleChatResponse(text || \"[no speech detected]\");\r\n    } catch (err) {\r\n      console.error(\"Error transcribing audio:\", err);\r\n    }\r\n  };\r\n\r\n  const convertTextToSpeech = async (text: string) => {\r\n    try {\r\n      const response = await fetch(\"https://api.openai.com/v1/audio/speech\", {\r\n        method: \"POST\",\r\n        cache: \"no-store\",\r\n        headers: {\r\n          Authorization: `Bearer ${process.env.NEXT_PUBLIC_OPENAI_KEY}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          model: \"tts-1-hd\",\r\n          voice: \"alloy\",\r\n          input: text,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        console.error(\"TTS status:\", response.status, await response.text());\r\n        throw new Error(`TTS failed: ${response.statusText}`);\r\n      }\r\n\r\n      const blob = await response.blob();\r\n      const url = URL.createObjectURL(blob);\r\n      playAudio(url);\r\n    } catch (error) {\r\n      console.error(\"Error with OpenAI TTS API:\", error);\r\n    }\r\n  };\r\n\r\n  const playAudio = (audioUrl: string) => {\r\n    const audio = new Audio(audioUrl);\r\n    audio.playbackRate = 0.7;\r\n    audio.play();\r\n  };\r\n\r\n  const handleChatResponse = useCallback(\r\n    async (userInput: string) => {\r\n      try {\r\n        const sys = new SystemMessage(prompt);\r\n        const human = new HumanMessage(userInput);\r\n        const message = await model.invoke([sys, human]);\r\n        const botReply = (message.content as string) ?? \"\";\r\n\r\n        setConversation((prev) => [\r\n          ...prev,\r\n          { from: userData.username, text: userInput },\r\n          { from: \"LingoListen AI\", text: botReply },\r\n        ]);\r\n\r\n        await convertTextToSpeech(botReply);\r\n      } catch (error) {\r\n        console.error(\"Error with OpenAI Chat API:\", error);\r\n      }\r\n    },\r\n    [model, prompt, userData.username]\r\n  );\r\n\r\n  if (isLoading) {\r\n    return <Loading />;\r\n  }\r\n\r\n  if (error) {\r\n    return <div>Error: {error}</div>;\r\n  }\r\n\r\n  return (\r\n    <main className=\"bg-white text-blue-500 mb-32\">\r\n      <section className=\"text-center p-8 z-10\">\r\n        <h1 className=\"text-5xl font-bold\">Welcome, {userData.username}</h1>\r\n        <p className=\"mt-6 mb-3 text-xl\">\r\n          Practice conversations in {userData.learningLanguage}.\r\n        </p>\r\n        {userData.difficulty &&\r\n          difficultyTips[userData.difficulty as DifficultyLevel] && (\r\n            <p className=\"mb-4\">\r\n              {difficultyTips[userData.difficulty as DifficultyLevel]}\r\n            </p>\r\n          )}\r\n        <div className=\"flex flex-col items-center\">\r\n          <span className=\"mb-4\">\r\n            Click to {isRecording ? \"stop recording\" : \"start recording\"}\r\n          </span>\r\n          <button onClick={handleRecordingToggle}>\r\n            <MicToggle />\r\n          </button>\r\n        </div>\r\n      </section>\r\n      <section className=\"flex justify-center p-8\">\r\n        {conversation.length > 0 ? (\r\n          <div className=\"chat-display bg-blue-500 text-white rounded p-4 w-1/2 md:text-lg text-sm overflow-y-scroll lg:max-h-96 md:max-h-72 sm:max-h-48\">\r\n            {conversation.map((entry, index) => (\r\n              <p key={index}>\r\n                {entry.from}: {entry.text}\r\n              </p>\r\n            ))}\r\n          </div>\r\n        ) : null}\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n\n</file>\n<file path=\"app\\LanguageSelection\\page.tsx\">\n\"use client\";\r\nimport React, { useState, useEffect, FormEvent } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Loading from \"@/components/loading\";\r\nimport useUserData from \"@/components/customHooks/useUserData\";\r\n\r\nconst LanguageSelection = () => {\r\n  const router = useRouter();\r\n  const { userData, isLoading, error } = useUserData();\r\n  const [nativeLanguage, setNativeLanguage] = useState(userData.nativeLanguage);\r\n  const [learningLanguage, setLearningLanguage] = useState(\r\n    userData.learningLanguage\r\n  );\r\n  const [difficulty, setDifficulty] = useState(userData.difficulty);\r\n\r\n  useEffect(() => {\r\n    if (userData && !isLoading && !error) {\r\n      setNativeLanguage(userData.nativeLanguage);\r\n      setLearningLanguage(userData.learningLanguage);\r\n      setDifficulty(userData.difficulty);\r\n    }\r\n  }, [userData, isLoading, error]);\r\n\r\n  if (isLoading) {\r\n    return <Loading />;\r\n  }\r\n\r\n  if (error) {\r\n    return <div>Error: {error}</div>;\r\n  }\r\n\r\n  const difficultyLevels = [\"Beginner\", \"Intermediate\", \"Expert\", \"Fluent\"];\r\n\r\n  const allLanguages: string[] = [\r\n    \"Spanish\",\r\n    \"English\",\r\n    \"French\",\r\n    \"German\",\r\n    \"Italian\",\r\n    \"Portuguese\",\r\n    \"Japanese\",\r\n    \"Chinese (Mandarin)\",\r\n    \"Korean\",\r\n    \"Arabic\",\r\n    \"Hindi\",\r\n    \"Russian\",\r\n    \"Turkish\",\r\n    \"Dutch\",\r\n    \"Swedish\",\r\n    \"Norwegian\",\r\n    \"Danish\",\r\n    \"Polish\",\r\n    \"Greek\",\r\n  ];\r\n\r\n  const handleLanguageChange = (language: string) => {\r\n    setLearningLanguage(language);\r\n  };\r\n\r\n  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    if (nativeLanguage === learningLanguage) {\r\n      alert(\"Native language and learning language must be different.\");\r\n      return;\r\n    }\r\n    try {\r\n      await axios.post(\"/api/languagePreferences\", {\r\n        nativeLanguage,\r\n        learningLanguage,\r\n        difficulty,\r\n        firstLogin: false,\r\n      });\r\n      router.push(\"/Dashboard\");\r\n    } catch (error) {\r\n      console.error(\"Error updating language preferences:\", error);\r\n    }\r\n  };\r\n\r\n  const buttonStyles =\r\n    \"mt-1 bg-white border-2 border-white text-blue-500 px-7 py-2 rounded duration-300 hover:bg-transparent hover:text-white\";\r\n  const selectStyles =\r\n    \"border-2 border-white bg-blue-100 text-blue-500 rounded p-2 w-56\";\r\n\r\n  return (\r\n    <div className=\"flex justify-center items-center w-full h-screen sm:-mt-0 -mt-16 bg-blue-500\">\r\n      <div className=\"p-8 text-white xl:w-2/5 xl:mb-72\">\r\n        {userData.firstLogin ? (\r\n          <h1 className=\"text-6xl font-bold mb-4\">\r\n            Welcome, {userData.username}!\r\n          </h1>\r\n        ) : null}\r\n        <h2 className=\"mb-6 text-xl\">\r\n          Select your native language and the language you want to learn{\" \"}\r\n          {userData.firstLogin ? \"(you can change your selection later)\" : null}\r\n        </h2>\r\n        <form onSubmit={handleSubmit} className=\"text-left\">\r\n          <div className=\"mb-4\">\r\n            <label className=\"block mb-2\">Native Language:</label>\r\n            <select\r\n              className={selectStyles}\r\n              value={nativeLanguage}\r\n              onChange={(e) => setNativeLanguage(e.target.value)}\r\n            >\r\n              {allLanguages.map((lang) => (\r\n                <option key={lang} value={lang}>\r\n                  {lang}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          <div className=\"mb-4\">\r\n            <label className=\"block mb-2\">Language to Learn:</label>\r\n            <select\r\n              className={selectStyles}\r\n              value={learningLanguage}\r\n              onChange={(e) => handleLanguageChange(e.target.value)}\r\n            >\r\n              {allLanguages.map((lang) => (\r\n                <option key={lang} value={lang}>\r\n                  {lang}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          <div className=\"mb-4\">\r\n            <label className=\"block mb-2\">Difficulty Level:</label>\r\n            <select\r\n              className={selectStyles}\r\n              value={difficulty}\r\n              onChange={(e) => setDifficulty(e.target.value)}\r\n            >\r\n              {difficultyLevels.map((level) => (\r\n                <option key={level} value={level}>\r\n                  {level}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          <button type=\"submit\" className={buttonStyles}>\r\n            Save Preferences\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LanguageSelection;\r\n\n</file>\n<file path=\"app\\ManageSubscription\\page.tsx\">\n\"use client\"\r\nimport React, { FC, useState, useCallback } from 'react';\r\nimport axios from 'axios';\r\nimport useUserData from \"@/components/customHooks/useUserData\";\r\nimport { PayPalScriptProvider, PayPalButtons } from \"@paypal/react-paypal-js\";\r\n\r\ninterface SubscriptionState {\r\n  hasTrial: boolean;\r\n  trialStart: Date | null;\r\n  isSubscribed: boolean;\r\n  trialEnd?: Date | null;\r\n}\r\n\r\nconst ManageSubscription: FC = () => {\r\n  const { userData, isLoading, error } = useUserData();\r\n  const [subscription, setSubscription] = useState<SubscriptionState>({\r\n    hasTrial: false,\r\n    trialStart: null,\r\n    isSubscribed: false,\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [cardComplete, setCardComplete] = useState(false);\r\n\r\n  const startTrial = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await axios.post('/api/subscription/startTrial', {}, {\r\n        headers: {\r\n          Authorization: 'Bearer ' + localStorage.getItem('token'), \r\n        }\r\n      });\r\n      if (response.data.success) {\r\n        setSubscription(prevState => ({\r\n          ...prevState,\r\n          hasTrial: true,\r\n          trialStart: new Date(response.data.trialEnd - 7 * 24 * 60 * 60 * 1000),\r\n          isSubscribed: false,\r\n        }));\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Failed to start trial:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const cancelSubscription = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await axios.post('/api/subscription/cancel');\r\n      if (response.data.success) {\r\n        setSubscription({\r\n          ...subscription,\r\n          isSubscribed: false,\r\n        });\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Failed to cancel subscription:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleStartTrial = useCallback(() => {\r\n    startTrial();\r\n  }, []);\r\n\r\n  const handleCancelSubscription = useCallback(() => {\r\n    cancelSubscription();\r\n  }, []);\r\n\r\n  const calculateRemainingTrialDays = useCallback(() => {\r\n    if (!userData || !userData.subscription?.trialStart) return 0;\r\n    const trialEnd = new Date(new Date(userData.subscription.trialStart).getTime() + 7 * 24 * 60 * 60 * 1000);\r\n    const today = new Date();\r\n    const remaining = (trialEnd.getTime() - today.getTime()) / (1000 * 3600 * 24);\r\n    return Math.max(0, Math.ceil(remaining));\r\n  }, [userData]);\r\n\r\n  if (loading) {\r\n    return <p>Loading...</p>;\r\n  }\r\n\r\n  return (\r\n    <PayPalScriptProvider options={{ clientId: process.env.PAYPAL_CLIENT_ID_SANDBOX! }}>\r\n    <div>\r\n      <h1>Manage Subscription</h1>\r\n      <p>Manage your subscription here.</p>\r\n      {error && <p className=\"text-red-500\">{error}</p>}\r\n      {!subscription.isSubscribed && !subscription.hasTrial && (\r\n        <PayPalButtons \r\n          createSubscription={(data, actions) => {\r\n            return actions.subscription.create({\r\n              plan_id: \"YOUR_PLAN_ID\",\r\n            });\r\n          }}\r\n          onApprove={(data, actions) => {\r\n            return new Promise<void>((resolve, reject) => {\r\n              // Perform your operations here. For example:\r\n              actions?.subscription?.get().then((details) => {-\r\n                console.log(\"Subscription details:\", details);\r\n                // Update state or perform further actions after subscription approval\r\n                resolve();\r\n              }).catch(error => {\r\n                console.error(\"Error during subscription get:\", error);\r\n                reject();\r\n              });\r\n            });\r\n          }}\r\n        />\r\n      )}\r\n      {subscription.hasTrial && (\r\n        <p>Trial remaining days: {calculateRemainingTrialDays()}</p>\r\n      )}\r\n      {subscription.isSubscribed ? (\r\n        <button onClick={handleCancelSubscription}>Cancel Subscription</button>\r\n      ) : (\r\n        <p>You are not currently subscribed.</p>\r\n      )}\r\n    </div>\r\n    </PayPalScriptProvider>\r\n  );\r\n};\r\n\r\nexport default ManageSubscription;\r\n\n</file>\n<file path=\"tsconfig.json\">\n{\r\n  \"compilerOptions\": {\r\n    \"target\": \"es5\",\r\n    \"typeRoots\": [\"./types\", \"./node_modules/@types\"],\r\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\r\n    \"allowJs\": true,\r\n    \"skipLibCheck\": true,\r\n    \"strict\": true,\r\n    \"noEmit\": true,\r\n    \"esModuleInterop\": true,\r\n    \"module\": \"esnext\",\r\n    \"moduleResolution\": \"bundler\",\r\n    \"resolveJsonModule\": true,\r\n    \"isolatedModules\": true,\r\n    \"jsx\": \"preserve\",\r\n    \"incremental\": true,\r\n    \"plugins\": [\r\n      {\r\n        \"name\": \"next\"\r\n      }\r\n    ],\r\n    \"paths\": {\r\n      \"@/*\": [\"./*\"],\r\n      \"auth\": [\"./auth\"]\r\n    }\r\n  },\r\n  \"include\": [\"next-env.d.ts\", \"**/*.ts\", \"**/*.tsx\", \".next/types/**/*.ts\", \"lib/db.ts\", \"helpers/decodeJWT.js\", \"./types/*.d.ts\", \"app/ForgotPassword/[resetToken]\"],\r\n  \"exclude\": [\"node_modules\"]\r\n}\r\n\n</file>\n<file path=\"types\\css.d.ts\">\n// Type definitions for CSS imports\r\ndeclare module \"*.css\" {\r\n  const content: { [className: string]: string };\r\n  export default content;\r\n}\r\n\r\n// For side-effect CSS imports (like globals.css)\r\ndeclare module \"*.css\" {\r\n  const content: any;\r\n  export = content;\r\n}\r\n\n</file>\n\n"
  } ],
  "stream" : true,
  "stream_options" : {
    "include_usage" : true
  },
  "max_completion_tokens" : 65535,
  "user" : "cc2a625b-a51e-402b-bdf7-b381ad378cea",
  "reasoning_effort" : "disable"
}